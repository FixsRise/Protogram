{% extends "index_base.html" %}
% load static %
<title>{% block title %}Login{% endblock %}</title>

{% block content %}
    <h1>Posts:</h1>
    <h2>Want to create your own post?</h2>
    <a href="{% url 'create_post' %}">+</a>
    <hr>
    <div id="posts-container">
        {% for post in posts %}
            {% include 'posts/post.html' with post=post %}
        {% endfor %}
    </div>

    {% if has_next %}
        <div class="load-more-container">
            <button id="load-more-btn" class="load-more-btn">Показать еще</button>
        </div>
    {% endif %}


<script>
    window.addEventListener('DOMContentLoaded', () => {
        const lastNewsId = "{{ last_news_id }}";
        if (lastNewsId) {
            const element = document.getElementById(`post-${lastNewsId}`);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const loadMoreBtn = document.getElementById('load-more-btn');
        const postsContainer = document.getElementById('posts-container');
        let page = 1;

        if (loadMoreBtn) {
            loadMoreBtn.addEventListener('click', function() {
                this.disabled = true;
                this.textContent = 'Загрузка...';

                fetch(`?page=${page + 1}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.html) {
                            postsContainer.insertAdjacentHTML('beforeend', data.html);
                            page++;

                            // Если больше нет постов, удаляем кнопку
                            if (!data.has_next) {
                                this.parentElement.remove();
                            } else {
                                this.disabled = false;
                                this.textContent = 'Показать еще';
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        this.disabled = false;
                        this.textContent = 'Показать еще';
                    });
            });
        }
    });
</script>

{% endblock %}


{% block modals %}
    {% include 'posts/includes/confirm_delete.html' %}
{% endblock %}

