{% extends 'index_base.html' %}

{% block content %}
<div class="edit-post-page">
    <div class="edit-post-header">
        <a href="{% url 'post_detail' post.id %}" class="back-link">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
        </a>
        <h2>Edit Post</h2>
        <div class="header-spacer"></div>
    </div>

    <div class="edit-post-content">
        <form method="post" enctype="multipart/form-data" class="edit-form">
            {% csrf_token %}

            <div class="image-section">
                <div class="current-image">
                    <img src="{{ form.instance.image.url }}" alt="Current post image" id="current-image">
                </div>

                <label for="id_image" class="change-image-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7m4 1h6m-3-3v6"/>
                        <circle cx="9" cy="9" r="2"/>
                        <path d="m21 15-3.1-3.1a2 2 0 0 0-2.814.014L6 21"/>
                    </svg>
                    Change Image
                    {{ form.image }}
                </label>
                {% if form.image.errors %}
                <div class="error-message">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ed4956">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12" y2="16"/>
                    </svg>
                    {{ form.image.errors|first }}
                </div>
                {% endif %}
            </div>

            <div class="caption-section">
                <label for="{{ form.caption.id_for_label }}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#8e8e8e">
                        <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                    </svg>
                    Caption
                </label>
                {{ form.caption }}
                {% if form.caption.errors %}
                <div class="error-message">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ed4956">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12" y2="16"/>
                    </svg>
                    {{ form.caption.errors|first }}
                </div>
                {% endif %}
            </div>

            <div class="form-actions">
                <button type="submit" class="save-button">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save Changes
                </button>
                <a href="{% url 'post_detail' post.id %}" class="cancel-button">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<style>
.edit-post-page {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
}

.edit-post-header {
    display: flex;
    align-items: center;
    padding: 16px 0;
    margin-bottom: 20px;
    border-bottom: 1px solid #efefef;
}

.edit-post-header h2 {
    margin: 0 auto;
    font-size: 18px;
    font-weight: 600;
    color: #262626;
}

.back-button {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #262626;
}

.header-spacer {
    width: 24px;
}

.edit-post-content {
    padding: 0 10px;
}

.image-section {
    margin-bottom: 24px;
}

.current-image {
    margin-bottom: 16px;
    text-align: center;
}

.current-image img {
    max-width: 100%;
    max-height: 400px;
    border-radius: 8px;
    object-fit: contain;
}

.change-image-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px;
    background: #f5f5f5;
    border-radius: 6px;
    color: #262626;
    font-weight: 500;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.2s;
}

.change-image-btn:hover {
    background: #eaeaea;
}

.change-image-btn svg {
    stroke-width: 2;
}

#id_image {
    display: none;
}

.caption-section {
    margin-bottom: 24px;
}

.caption-section label {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    font-size: 14px;
    color: #262626;
    font-weight: 500;
}

.caption-section label svg {
    stroke-width: 1.5;
}

#id_caption {
    width: 100%;
    padding: 12px;
    border: 1px solid #dbdbdb;
    border-radius: 8px;
    font-size: 14px;
    min-height: 120px;
    resize: vertical;
}

#id_caption:focus {
    outline: none;
    border-color: #3897f0;
}

.error-message {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 8px;
    color: #ed4956;
    font-size: 13px;
}

.error-message svg {
    stroke-width: 2;
}

.form-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
}

.save-button {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px;
    background: #3897f0;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 500;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.2s;
}

.save-button:hover {
    background: #2684f0;
}

.save-button svg {
    stroke-width: 2;
}

.cancel-button {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 12px;
    background: white;
    color: #262626;
    border: 1px solid #dbdbdb;
    border-radius: 8px;
    font-weight: 500;
    font-size: 14px;
    text-decoration: none;
    transition: background 0.2s;
}

.cancel-button:hover {
    background: #fafafa;
}

@media (max-width: 480px) {
    .edit-post-page {
        padding: 0;
    }

    .form-actions {
        flex-direction: column;
    }
}
</style>

<script>
document.getElementById('id_image').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('current-image').src = e.target.result;
        }
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}